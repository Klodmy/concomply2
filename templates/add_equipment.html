{% extends "base.html" %}
{% block title %}Equipment - ConComply{% endblock %}
{% block content %}
<section class="split">
    <div class="panel" data-reveal>
        <h2>Add equipment</h2>
        <p class="muted">Log every asset so service and repair records stay accurate.</p>
        {% if current_user and current_user.role == "admin" %}
            <form method="POST" class="form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <label>
                    Type
                    <input type="text" name="type" required>
                </label>

                <label>
                    VIN Number
                    <input type="text" name="vin_number" required>
                </label>

                <label>
                    Code
                    <input type="text" name="code" required>
                </label>

                <label>
                    Make
                    <input type="text" name="make" required>
                </label>

                <label>
                    Model
                    <input type="text" name="model" required>
                </label>

                <label>
                    Mileage
                    <input type="number" name="mileage" min="0">
                </label>

                <label>
                    Service Required
                    <input type="text" name="service_required" placeholder="E.g. 500-hour check">
                </label>

                <label>
                    Last Service Date
                    <input type="date" name="last_service_date">
                </label>

                <button type="submit" class="button primary full">Add Equipment</button>
            </form>
        {% else %}
            <div class="empty-state">
                <h3>Admin access required</h3>
                <p>Contact an admin to add or edit equipment.</p>
            </div>
        {% endif %}
    </div>

    <div class="panel wide" data-reveal>
        <div class="panel-header">
            <div>
                <h2>Equipment list</h2>
                <p class="muted">Search, filter, or export reports.</p>
            </div>
            <form method="GET" class="filters">
                <input type="text" name="search" placeholder="Search code, VIN, make..." value="{{ search }}">
                <select name="type">
                    <option value="">All types</option>
                    {% for type in equipment_types %}
                        <option value="{{ type }}" {% if equipment_type == type %}selected{% endif %}>{{ type }}</option>
                    {% endfor %}
                </select>
                <select name="sort">
                    <option value="type" {% if sort == "type" %}selected{% endif %}>Sort by Type</option>
                    <option value="code" {% if sort == "code" %}selected{% endif %}>Sort by Code</option>
                    <option value="make" {% if sort == "make" %}selected{% endif %}>Sort by Make</option>
                </select>
                <button class="button ghost" type="submit">Apply</button>
            </form>
        </div>

        {% if equipment_list %}
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Code</th>
                            <th>Make / Model</th>
                            <th>VIN</th>
                            <th>Mileage</th>
                            <th>Last Service</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for equipment in equipment_list %}
                            <tr>
                                <td>{{ equipment.type }}</td>
                                <td>
                                    <div class="cell-strong">{{ equipment.code }}</div>
                                    <div class="cell-muted">{{ equipment.service_required if equipment.service_required else 'No service interval' }}</div>
                                </td>
                                <td>
                                    <div class="cell-strong">{{ equipment.make }}</div>
                                    <div class="cell-muted">{{ equipment.model }}</div>
                                </td>
                                <td>{{ equipment.vin_number }}</td>
                                <td>{{ equipment.mileage if equipment.mileage else 'N/A' }}</td>
                                <td>{{ equipment.last_service_date if equipment.last_service_date else 'N/A' }}</td>
                                <td class="actions">
                                    <a class="button ghost" href="{{ url_for('new_service', equipment_id=equipment.id) }}">Service</a>
                                    <a class="button ghost" href="{{ url_for('new_repair', equipment_id=equipment.id) }}">Repair</a>
                                    <a class="button ghost" href="{{ url_for('equipment_report', equipment_id=equipment.id) }}">CSV</a>
                                    <a class="button ghost" href="{{ url_for('equipment_qr', equipment_id=equipment.id) }}">QR</a>
                                    <a class="button ghost" href="{{ url_for('equipment_checkins', equipment_id=equipment.id) }}">Check-ins</a>
                                    {% if current_user and current_user.role == "admin" %}
                                        <form method="POST" action="{{ url_for('delete_equipment', equipment_id=equipment.id) }}" onsubmit="return confirm('Are you sure?');">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                            <button type="submit" class="button danger">Delete</button>
                                        </form>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-state">
                <h3>No equipment yet</h3>
                <p>Start by adding your first asset to unlock service and repair tracking.</p>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}
